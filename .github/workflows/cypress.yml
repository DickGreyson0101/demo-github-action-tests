name: Cypress Tests # Specifies the name of the workflow as it will appear in the GitHub Actions tab.

on:
  workflow_dispatch: # Allows the workflow to be triggered manually from the GitHub Actions tab.

jobs:
  cypress-run: # Defines a job named 'cypress-run'.
    runs-on: ubuntu-latest # Specifies that the job should run on the latest available version of Ubuntu runner.
    timeout-minutes: 60 # Sets a maximum execution time of 60 minutes for the job to prevent hanging processes suitable for CI/CD cost.

    defaults:
      run:
        working-directory: cypress # Sets the default working directory for all 'run' steps to the 'cypress' folder.

    steps:
      - uses: actions/checkout@v4 # Checks out the repository code so the workflow can access it.

      - uses: actions/setup-node@v4 # Sets up the Node.js environment.
        with:
          node-version: lts/* # Uses the latest Long Term Support (LTS) version of Node.js.
          cache: 'npm' # Caches npm dependencies to speed up subsequent runs.
          cache-dependency-path: cypress/package-lock.json # Specifies the path to the lock file for accurate caching.

      - name: Install dependencies # Friendly name for the step.
        run: npm ci # Installs dependencies cleanly based on package-lock.json (faster and more reliable than npm install).

      - name: Run Cypress # Friendly name for the step.
        run: npx cypress run # Executes the Cypress tests in headless mode.

      - name: Upload Cypress videos/screenshots # Friendly name for the step.
        if: ${{ !cancelled() }} # Ensures this step runs even if previous steps fail, so we still get logs/videos for debugging.
        uses: actions/upload-artifact@v4 # Uses the actions/upload-artifact action to save files.
        with:
          name: cypress-artifacts # Names the artifact 'cypress-artifacts' for download.
          path: | # Specifies the files/folders to include in the artifact.
            cypress/cypress/videos
            cypress/cypress/screenshots
          retention-days: 30 # Keeps the artifacts available for download for 30 days.
